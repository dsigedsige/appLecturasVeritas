@{
    ViewBag.Title = "visualizarFotos_index";
    Layout = "~/Views/Shared/_LayoutPrincipal.cshtml";
}

@using System.Configuration;
@using DSIGE
@using DSIGE.Modelo
@using DSIGE.Negocio

@{
    ViewBag.Title = ".:: Visualizar Fotos de Cortes Y Reconexiones ::.";
    Layout = "~/Views/Shared/_LayoutPrincipal.cshtml";
}

@section instances{
    @Styles.Render("~/Content/bootstrap-table/bootstrap-table.css")
    @Scripts.Render("~/Content/bootstrap-table/bootstrap-table.js")

    @Scripts.Render("~/Content/bootstrap-table/locale/bootstrap-table-es-MX.js")
    @Scripts.Render("~/Content/bootstrap/js/bootstrap-toggle.min.js")
    @Styles.Render("~/Content/bootstrap/css/bootstrap-toggle.min.css")

    @Styles.Render("~/Content/bootstrap-datepicker/css/bootstrap-datepicker.min.css")
    @Scripts.Render("~/Content/bootstrap-datepicker/js/bootstrap-datepicker.min.js")
    @Scripts.Render("~/Content/bootstrap-datepicker/locales/bootstrap-datepicker.es.min.js")

    @Scripts.Render("~/Content/angular/angular.js")

    @Scripts.Render("~/Content/bootstrap/js/bootstrap-filestyle.min.js")
    @Scripts.Render("~/Scripts/jquery.fileDownload.js")
     <script src="~/Content/angularfire/angularfire.min.js"></script>

    @Scripts.Render("~/Content/dataTables-bootstrap/js/jquery.dataTables.min.js")
    @Scripts.Render("~/Content/dataTables-bootstrap/js/dataTables.bootstrap.min.js")


    <link href="~/Content/lightbox/css/lightbox.css" rel="stylesheet" />
    <script src="~/Content/lightbox/js/lightbox.js"></script>
}

@section styles{
    <style type="text/css">
        .fixed-table-toolbar .search {
            line-height: 0;
        }

        .form-control {
            font-size: 11px;
            width: 100%;
            height: 28px;
        }

        label {
            font-family: "Tahoma", "Geneva", sans-serif;
            font-size: 12px;
            font-weight: bold;
        }

        .nav-tabs {
            border-bottom: 0;
        }

        #_archivo.btn-info {
            background-image: none;
            color: inherit;
            background-color: inherit !important;
        }

        .modal-dialog {
            width: 300px;
        }

        #modalLecturass {
            width: 530px;
        }

        #modalcortess {
            width: 530px;
        }

        #modalhistorico {
            width: 500px;
        }

        #modalpendientes {
            width: 500px;
        }

        .datepicker {
            width: 200px;
        }


        #table-consulta_lec td {
            color: black;
        }

        #table-consulta_reclec td {
            color: black;
        }

        #Principal {
            width: 98%;
            height: 400px;
        }

        input[type=search] {
            width: 300px !important;
        }


        [tooltip]:before {
            /* needed - do not touch */
            content: attr(tooltip);
            position: absolute;
            opacity: 0;
            /* customizable */
            transition: all 0.15s ease;
            padding: 10px;
            color: red;
            border-radius: 10px;
            box-shadow: 2px 2px 1px silver;
            font-family: Tahoma
        }

        [tooltip]:hover:before {
            /* needed - do not touch */
            opacity: 1;
            /* customizable */
            background: beige;
            margin-top: -50px;
            margin-left: 20px;
        }

        [tooltip]:not([tooltip-persistent]):before {
            pointer-events: none;
        }

        .check {
            margin-top: -5px;
            margin-bottom: -5px;
        }

        .Julio table, th {
            background-color: #333 !important;
            color: white !important;
        }

        [class^="icon-"], [class*=" icon-"] {
            font-size: 15px;
        }

        #form_actualizar {
            margin-top: 10px;
        }
    </style>
}

@section scripts{

    <script>
        lightbox.option({
            'resizeDuration': 200,
            'wrapAround': true
        })
    </script>
    <script type="text/javascript">

        //var ruta = '@ConfigurationManager.AppSettings["Rutafoto"]';

        function soloNumeros(e) {
            var key = window.Event ? e.which : e.keyCode
            return (key >= 48 && key <= 57)
        }

        var app = angular.module('appLecturaEnviarCliente', [])

          .directive('fileModel', ['$parse', function ($parse) {

            return {
                restrict: 'A',
                link: function (scope, element, attrs) {
                    var model = $parse(attrs.fileModel);
                    var modelSetter = model.assign;

                    element.bind('change', function () {
                        scope.$apply(function () {
                            modelSetter(scope, element[0].files[0]);
                        });
                    });
                }
            };
        }])
        app.service('fileUpload', ['$http', function ($http) {
            this.uploadFileToUrl = function (idlocal, file, uploadUrl) {

                var fd = new FormData();
                fd.append('file', file);
                fd.append('idlocal', idlocal);
                $http.post(uploadUrl, fd, {
                    transformRequest: angular.identity,
                    headers: { 'Content-Type': undefined }
                })
                .success(function (data) {

                })
                .error(function () {

                });
            }
        }]);

        app.directive('onFinishRender', function ($timeout) {
            return {
                restrict: 'A',
                link: function (scope, element, attr) {
                    if (scope.$last === true) {
                        $timeout(function () {
                            scope.$emit(attr.onFinishRender);
                        });
                    }
                }
            }
        });


        app.controller('LecturaEnviarClienteCtrl', function ($scope, $http, $timeout, fileUpload) {


            //inicializando fechas
            $(function () {
                $('#dtp_fechaAsigna').datepicker({
                    format: 'dd/mm/yyyy',
                    language: 'es',
                    autoclose: true
                });
            })

            $(function () {
                $('#_fechaEnvioMovil').datepicker({
                    format: 'dd/mm/yyyy',
                    language: 'es',
                    autoclose: true
                });
            })
            $(function () {
                $('#_fechaPendientes').datepicker({
                    format: 'dd/mm/yyyy',
                    language: 'es',
                    autoclose: true
                });
            })

            $(function () {
                $('#dtp_fecha_lectura').datepicker({
                    format: 'dd/mm/yyyy',
                    language: 'es',
                    autoclose: true
                });
            })



            oTable = null;


            var oTable_alerta = null;
            $scope.$on('ngRepeatFinished_alerta', function (ngRepeatFinishedEvent) {
                $('.sige-load').hide();
                document.getElementById("form_cabecera").style.display = "";
                oTable_alerta = $('#tbl_alertas').DataTable(
                    {
                        scrollY: "350px",
                        paging: false,
                    });
            });


            var oTablePendiente = null;
            $scope.$on('ngRepeatFinishedPendiente', function (ngRepeatFinishedEvent) {
                oTablePendiente = $('#tbl_VisualizarPendientes').DataTable(
                    {
                        scrollY: "350px",
                        paging: false,
                    });
            });

            var oTable_cabeceraLecturas = null;
            $scope.$on('ngRepeatFinished_Lectura', function (ngRepeatFinishedEvent) {
                oTable_cabeceraLecturas = $('#tblLecturasRelecturas').DataTable(
                    {
                        scrollY: "400px",
                        paging: false,
                    });
            });


            var oTablePendiente_Det = null;
            $scope.$on('ngRepeatFinishedPendiente_Det', function (ngRepeatFinishedEvent) {
                oTablePendiente_Det = $('#tbl_detallado_Pendientes').DataTable(
                    {
                        scrollY: "350px",
                        paging: false,
                    });
            });


            var oTable_actualizar = null;
            $scope.$on('ngRepeatFinished_actualizar', function (ngRepeatFinishedEvent) {
                $('.sige-load').hide();
                document.getElementById("form_actualizar").style.display = "";
                oTable_actualizar = $('#tbl_actualizar').DataTable(
                    {
                        scrollY: "350px",
                        paging: false,
                    });
            });



            var pictures = $scope.pictures = [];

            $scope.edicionFoto = false;
            $scope.MostrarFoto = function (idLectura, flagOpcion) {

                var cbo_servicio = document.getElementById('cbo_servicio').value;
                $('.sige-load').show();

                $scope.edicionFoto = false;
                if (cbo_servicio == 3 || cbo_servicio == "3" || cbo_servicio == 4 || cbo_servicio == "4" ) {
                    $scope.edicionFoto = true;
                }

                $scope.pictures = [];
                var variables = {
                    method: 'post',
                    url: '../LecturaEnviarCliente/FotosLectura',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        id_lectura: idLectura,
                        opcion: flagOpcion
                    },
                }
                $http(variables)
                .success(function (data) {
                    $('.sige-load').hide();

                    $('#modalfotos').modal();

                    pictures = $scope.pictures = [];
                    for (var i = 0; i < data.length; i++) {
                        pictures.push({
                            id_foto: data[i].id_Lectura,
                            url: data[i].foto,
                            nombreFoto: data[i].nombreFoto,
                        });
                    }
                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            }


 
            $scope.ListaObservaciones = [];
            $scope.listando_ObservacionesCortes = function () {
                var variables = {
                    method: 'post',
                    url: '../LecturaEnviarCliente/ListandoObservacionesCortes',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                }
                $http(variables)
                .success(function (data) {
                    $scope.ListaObservaciones = [];
                    $scope.ListaObservaciones = data;
                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.ListaObservacionesResultado = [];
            $scope.listando_ObservacionesCortesResultado = function () {
                var variables = {
                    method: 'post',
                    url: '../LecturaEnviarCliente/ListandoObservacionesCortesResultado',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                }
                $http(variables)
                .success(function (data) {
                    $scope.ListaObservacionesResultado = [];
                    $scope.ListaObservacionesResultado = data;
                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.listando_ObservacionesReconexion = function () {
                var variables = {
                    method: 'post',
                    url: '../LecturaEnviarCliente/ListandoObservacionesReconexion',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                }
                $http(variables)
                .success(function (data) {
                    $scope.ListaObservaciones = [];
                    $scope.ListaObservaciones = data;
                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.Listando_ObservacionesReconexionResultado = function () {
                var variables = {
                    method: 'post',
                    url: '../LecturaEnviarCliente/ListandoObservacionesReconexionResultado',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                }
                $http(variables)
                .success(function (data) {
                    $scope.ListaObservacionesResultado = [];
                    $scope.ListaObservacionesResultado = data;
                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.ChangeObservaciones = function (tipoServicio) {

                var cbo_local = document.getElementById('cbo_local').value;
                var cbo_servicio = document.getElementById('cbo_servicio').value;
                //if (cbo_local == 0 || cbo_local == "0") {
                //    return;
                //}
                if (cbo_servicio == 0 || cbo_servicio == "0" || cbo_servicio == '? undefined:undefined ?') {
                    return;
                }

                if (tipoServicio == '1' || tipoServicio == 1 || tipoServicio == '2' || tipoServicio == 2) {
                    $scope.listando_ObservacionesLecturas();
                }
                else if (tipoServicio == '3' || tipoServicio == 3) {
                    $scope.listando_ObservacionesCortes();
                    setTimeout(function () {
                        $scope.listando_ObservacionesCortesResultado()
                    }, 1000);
                }
                else if (tipoServicio == '4' || tipoServicio == 4) {
                    $scope.listando_ObservacionesReconexion();
                    setTimeout(function () {
                        $scope.Listando_ObservacionesReconexionResultado()
                    }, 1000);
                }
            }

            $scope.FlagLectura = false;
            $scope.FlagCodObservacion = false;
            $scope.campo_opcion = '';
 
            $scope.FlagLecturaCorte = false;
            $scope.FlagCorteCodObservacion = false;
            $scope.FlagCorteCodObservacionResultado = false;
            $scope.campo_opcion_Cortes = '';
            
            $scope.UpdateCortesReconexiones = function () {

                var codCorteLectura = document.getElementById('txt_edit_idcorte').value;
                var _DatoModificarCorte = '';

                if ($scope.campo_opcion_Cortes == 'corte_lectura') {

                    var CorteLecturaMovil = document.getElementById('txt_edit_lecturacorte').value;
                    _DatoModificarCorte = CorteLecturaMovil;

                } else if ($scope.campo_opcion_Cortes == 'cod_observacion') {
                    var CodObservacionCorte = document.getElementById('txt_edit_Corteobservacion').value;
                    var valorTextoSeleccionadoObs = $("#txt_edit_Corteobservacion option:selected").html();
                    _DatoModificarCorte = CodObservacionCorte;

                    if (CodObservacionCorte == 0 || CodObservacionCorte == '0') {
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Por favor seleccione una Observación. Muchas gracias.',
                            type: 'error'
                        });
                        return false;
                    }
                } else if ($scope.campo_opcion_Cortes == 'cod_observacionResultado') {
                    var CodObservacionResultado = document.getElementById('txt_edit_CorteobservacionResultado').value;
                    var valorTextoSeleccionadoResultado = $("#txt_edit_CorteobservacionResultado option:selected").html();
                    _DatoModificarCorte = CodObservacionResultado;

                    if (CodObservacionResultado == 0 || CodObservacionResultado == '0') {
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Por favor seleccione un Resultado. Muchas gracias.',
                            type: 'error'
                        });
                        return false;
                    }
                }

                $('.sige-load').show();
                var variables = {
                    method: 'post',
                    url: '../LecturaEnviarCliente/ActualizandoCortesReconexiones',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        cod_Cortelectura: codCorteLectura,
                        DatoModificar: _DatoModificarCorte,
                        campoModificar: $scope.campo_opcion_Cortes
                    }
                }
                $http(variables)
                .success(function (data) {
                    if (data == '"Ok"') {
                        $('.sige-load').hide();
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Se actualizó la información. Muchas gracias',
                            type: 'success'
                        });

                        if ($scope.campo_opcion_Cortes == 'corte_lectura') {
                              for (var i = 0; i < $scope.ListaCortes.length; i++) {
                                if ($scope.ListaCortes[i].id_Lectura == codCorteLectura) {
                                    $scope.ListaCortes[i].lectura = _DatoModificarCorte;
                                    break;
                                }
                            }
                        } else {
                            for (var i = 0; i < $scope.ListaCortes.length; i++) {
                                if ($scope.ListaCortes[i].id_Lectura == codCorteLectura) {
                                        if ($scope.campo_opcion_Cortes == 'cod_observacion') {
                                            $scope.ListaCortes[i].id_Observacion_corte = _DatoModificarCorte
                                            $scope.ListaCortes[i].observacion = valorTextoSeleccionadoObs;
                                                break;
                                        }
                                        else if ($scope.campo_opcion_Cortes == 'cod_observacionResultado') {
                                            $scope.ListaCortes[i].id_resultadoObsCorte = _DatoModificarCorte
                                            $scope.ListaCortes[i].id_observacionResultado_corte = valorTextoSeleccionadoResultado;
                                                break;
                                        }
                                    }
                                }
                        }

                        $("#modal_EditarCortesReconexiones").modal('hide');

                    } else {
                        alert(data);
                    }

                })
                .error(function () {
                    $('.sige-load').hide();
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            }


            $scope.ListaLocales = [];
            $scope.ListaServicios = [];
            $scope.ListaEstados = [];
            $scope.ListaTecnico = [];
            $scope.ListaTecnicoReasignar = [];

            $scope.ListaLecturasRelectura = [];
            $scope.ListaCortes = [];

            $scope.Flag_Show_LecturaRelectura = false;
            $scope.Flag_Show_CorteReconexion = false;
            $scope.Flag_Show_Reparto = false;


            ///Mostrando Foto

            var listPhotos = [];
            $scope.previusPhoto= function() {
                var photo1 = document.getElementById('foto1');
                photo1.src = listPhotos[0].url;
            }
            $scope.nextPhoto= function() {
                var photo1 = document.getElementById('foto1');
                if (listPhotos.length > 1) {
                    photo1.src = listPhotos[1].url;
                }
            }



            $scope.listTrabajos = [];
            // PRE-ENVIO
            $scope.DescargaExcel_PreEnvio = function () {
                if (ValidacionesGenerales() == false) {
                    return;
                }
                var cbo_local = document.getElementById('cbo_local');
                var cbo_servicio = document.getElementById('cbo_servicio');
                var cbo_estado = document.getElementById('cbo_estado');
                var txt_suministro = document.getElementById('txt_suministro');
                var txt_medidor = document.getElementById('txt_medidor');
                var cbo_tecnico = document.getElementById('cbo_tecnico');
                var dtp_fechaAsigna = document.getElementById('dtp_fechaAsigna');

                var cbo_supervisor = document.getElementById('cbo_supervisor').value;
                var cbo_Operario_supervisor = document.getElementById('cbo_Operario_supervisor').value;

                if (cbo_servicio.value == 1 || cbo_servicio.value == '1') {
                    if (cbo_supervisor == '' || cbo_supervisor == '-1' || cbo_supervisor == -1) {
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Por favor seleccione un supervisor',
                            type: 'error'
                        });
                        return;
                    }
                }

                $('.sige-load').show();

                var urls = "";
                if (cbo_servicio.value == 3 || cbo_servicio.value == '4') {
                    urls = '../LecturaEnviarCliente/DescargaExcel_PreEnvio_CortesReconexiones';
                } else {
                    urls = '../LecturaEnviarCliente/DescargaExcel_PreEnvio'
                }

                var variables = {
                    method: 'post',
                    url: urls,
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        id_local: 1,
                        id_tipo_servicio: cbo_servicio.value,
                        estado: cbo_estado.value,
                        suministro: txt_suministro.value,
                        medidor: txt_medidor.value,
                        tecnico: cbo_tecnico.value,
                        fechaAsignacion: dtp_fechaAsigna.value,
                        id_supervisor: cbo_supervisor,
                        id_operario_supervisor: cbo_Operario_supervisor
                    }
                }
                $http(variables)
                .success(function (data) {
                    var res = data.split("|");
                    if (res[0].replace(/["]/gi, '') == "0" || res[0].replace(/["]/gi, '') == 0) {
                        alert(res[1]);
                    } else {
                        var url = res[1].replace(/["]/gi, '');
                        window.open(url);
                    }
                    $('.sige-load').hide();
                })
                .error(function () {
                    $('.sige-load').hide();
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };
            // FIN DE PRE-ENVIO




            // EXPORTAR A EXCEL
            var tableToExcel = function (tableId) {

                console.log('intro')
                var uri = 'data:application/vnd.ms-excel;base64,',
                      template = '<html lang="es" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Importar</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',
                      base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))); },
                      format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) };

                var table = $(tableId),
                             ctx = { worksheet: 'descar123', table: table.html() };

                var link = document.createElement("a");
                link.download = "Trabajos.xls";
                link.href = uri + base64(format(template, ctx));
                link.click()
            }

            $scope.InicializandoVariables = function () {
                $scope.id_local = '1';
                $scope.id_tipoServicio = '0';
                $scope.ListaLecturasRelectura = [];
                $scope.ListaCortes = [];
                $scope.Flag_Show_LecturaRelectura = true;
                $scope.Flag_Show_CorteReconexion = false;
                $scope.Flag_Show_Reparto = false;

                setTimeout(function () {
                    var cbo_servicio = document.getElementById('cbo_servicio');
                    var cbo_estado = document.getElementById('cbo_estado');
                    var txt_suministro = document.getElementById('txt_suministro');
                    var txt_medidor = document.getElementById('txt_medidor');
                    var cbo_tecnico = document.getElementById('cbo_tecnico');
                    var dtp_fechaAsigna = document.getElementById('dtp_fechaAsigna');

                    $('#cbo_local').val(1).trigger('change');
                    cbo_servicio.value = '0';
                    cbo_estado.value = '0';
                    txt_suministro.value = '';
                    txt_medidor.value = '';
                    cbo_tecnico.value = '0';
                }, 1000);

            }

            $scope.listando_Locales = function () {

                var variables = {
                    method: 'post',
                    url: '../AsignaOrdenTrabajo/ListandoLocales',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    }
                }
                $http(variables)
                .success(function (data) {
                    $scope.ListaLocales = data;
                    $scope.listando_Servicios();
                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.listando_Servicios = function () {
                var variables = {
                    method: 'POST',
                    url: '../AsignaOrdenTrabajo/ListandoServicios',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    }
                }
                $http(variables)
                    .success(function (data) {
                        console.log(data);
                        $scope.ListaServicios = data.filter((s) => (s.id_TipoServicio == 3 || s.id_TipoServicio == 4 ) );

                    $scope.listando_Estados();
                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.listando_Estados = function () {
                var variables = {
                    method: 'POST',
                    url: '../LecturaEnviarCliente/ListandoEstadosLectura',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    }
                }

                $http(variables)
                .success(function (data) {
                    $scope.ListaEstados = data;
                    $scope.InicializandoVariables();
                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.listando_Tecnico = function (local, servicio) {
                var variables = {
                    method: 'POST',
                    url: '../AsignaOrdenTrabajo/ListandoTecnicos',

                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        id_local: local,
                        id_tipo_servicio: servicio
                    }
                }
                $('.sige-load').show();
                $http(variables)
                .success(function (data) {
                    $('.sige-load').hide();
                    $scope.ListaTecnico = [];
                    $scope.ListaTecnicoReasignar = [];
                    $scope.ListaTecnico = data;
                    $scope.ListaTecnicoReasignar = data;
                })
                .error(function () {
                    $('.sige-load').hide();
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.Tecnico_Change = function (id) {

                var cbo_local = document.getElementById('cbo_local').value;
                var cbo_servicio = document.getElementById('cbo_servicio').value;
                //if (cbo_local == 0 || cbo_local == "0") {
                //    return;
                //}
                if (cbo_servicio == 0 || cbo_servicio == "0" || cbo_servicio == '? undefined:undefined ?') {
                    return;
                }

                setTimeout(function () {
                    //mostrando info de los tecnicos
                    $scope.listando_Tecnico(1, cbo_servicio);
                }, 100);

            }

            $scope.Servicios_Change = function (id) {
                const cbo_servicio = document.getElementById('cbo_servicio').value;
                const txt_suministro = document.getElementById('txt_suministro');

                if (cbo_servicio == 0 || cbo_servicio == "0" || cbo_servicio == '? undefined:undefined ?') {
                    console.log('no hay servicio')
                    return;
                }

                $scope.ListaLecturasRelectura = [];
                $scope.ListaCortes = [];
                $scope.ListaReparto = [];

                $scope.Flag_Show_LecturaRelectura = false;
                $scope.Flag_Show_CorteReconexion = false;
                $scope.Flag_Show_Reparto = false;

                $scope.checkSuministros = false;
                txt_suministro.disabled = false;

                if (cbo_servicio == 1 || cbo_servicio == 2 || cbo_servicio == 9 ) {
                    $scope.Flag_Show_LecturaRelectura = true;
                    $scope.camposHistorico = false;
                }
                if (cbo_servicio == 3 || cbo_servicio == 4) {
                    $scope.Flag_Show_CorteReconexion = true;
                }
                if (cbo_servicio == 6 || cbo_servicio == '6') {
                    $scope.Flag_Show_Reparto = true;
                }
            }

            function ValidacionesGenerales() {
                var cbo_local = document.getElementById('cbo_local');
                var cbo_servicio = document.getElementById('cbo_servicio');
                var cbo_estado = document.getElementById('cbo_estado');
 
                if (cbo_servicio.value == '0' || cbo_servicio.value == "0") {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione un Servicio. Muchas gracias.',
                        type: 'error'
                    });
                    return false;
                }

                if (cbo_estado.value == '0' || cbo_estado.value == "0") {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione un Estado. Muchas gracias.',
                        type: 'error'
                    });
                    return false;
                }
                return true;
            }

            $scope.ListandoInformacionOrdenesTrabajo = function () {

                if (ValidacionesGenerales() == false) {
                    return;
                }

                var cbo_servicio = document.getElementById('cbo_servicio');
                var cbo_estado = document.getElementById('cbo_estado');
                var dtp_fechaAsigna = document.getElementById('dtp_fechaAsigna');

                var txt_suministro = document.getElementById('txt_suministro');
                var txt_medidor = document.getElementById('txt_medidor');
                var cbo_tecnico = document.getElementById('cbo_tecnico');

 
                if (cbo_servicio.value == 1 || cbo_servicio.value == '1' ) {
                    if (cbo_supervisor == '' || cbo_supervisor == '-1' || cbo_supervisor == -1) {
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Por favor seleccione un supervisor',
                            type: 'error'
                        });
                        return;
                    }
                }

                $('.sige-load').show();

                var variables = {
                    method: 'POST',
                    url: '../LecturaEnviarCliente/Listando_fotosCortesReconexiones',

                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
 
                        servicio: cbo_servicio.value,
                        estado: cbo_estado.value,
                        fechaAsignacion: dtp_fechaAsigna.value,

                        suministro: txt_suministro.value,
                        medidor: txt_medidor.value,
                        tecnico: cbo_tecnico.value, 
                    }
                }
                $scope.ListaCortes = [];
                $http(variables)
                    .success(function (data) {
                    $('.sige-load').hide();
                    $scope.ListaCortes = data;              

                })
                .error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                    $scope.ListaLecturasRelectura = [];
                    $scope.ListaCortes = [];
                    $('.sige-load').hide();
                });
            }


            // METODO PARA CHEKED ALL
            $scope.checkedAll = false;
            $scope.checkedAll_OrdenTrabajo = function (checked, TipoTrabajo) {
                if (TipoTrabajo == 1) {  // Lecturas Relecturas
                    var chk_pendientes = document.getElementById('chk_pendientes').checked;

                    if (checked) {
                        angular.forEach($scope.ListaLecturasRelectura, function (child) {
                            if (chk_pendientes == true) {
                                if (child.PorcentajeMayo == 'SI' || child.LecturaMenor == 'SI') {
                                    child.checkeado = true;
                                }
                            } else {
                                child.checkeado = true;
                            }
                        })
                    } else {
                        angular.forEach($scope.ListaLecturasRelectura, function (child) {
                            child.checkeado = false;
                        })
                    }
                } else if (TipoTrabajo == 2) {  // Cortes Reconexiones
                    if (checked) {
                        angular.forEach($scope.ListaCortes, function (child) {
                            child.checkeado = true;
                        })
                    } else {
                        angular.forEach($scope.ListaCortes, function (child) {
                            child.checkeado = false;
                        })
                    }
                }
                else if (TipoTrabajo == 3) {  // Reparto
                    if (checked) {
                        angular.forEach($scope.ListaReparto, function (child) {
                            child.checkeado = true;
                        })
                    } else {
                        angular.forEach($scope.ListaReparto, function (child) {
                            child.checkeado = false;
                        })
                    }
                }
            }


            //Historico Lectura Relectura
            $scope.OrdenTrabajo_Historico_LecturasRelecturas = function (id_suministro) {
                $('.sige-load').show();
                var TipoServicio = document.getElementById('cbo_servicio').value;
                var variables = {
                    method: 'POST',
                    url: '../AsignaOrdenTrabajo/LecturasRelectura_Historico',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        suministro: id_suministro,
                        tiposervicio: TipoServicio
                    }
                }
                $scope.Lista_OrdenTrabajo_LecturaRelectura = [];
                $http(variables)
                .success(function (data) {
                    $scope.Lista_OrdenTrabajo_LecturaRelectura = data;
                    $('.sige-load').hide();
                })
                .error(function () {
                    $('.sige-load').hide();
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };
            //Historico Cortes y reconexiones

            $scope.OrdenTrabajo_Historico_CortesReconexiones = function (id_suministro) {

                var TipoServicio = document.getElementById('cbo_servicio').value;

                $('.sige-load').show();
                var variables = {
                    method: 'POST',
                    url: '../AsignaOrdenTrabajo/CortesReconexiones_Historico',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        suministro: id_suministro,
                        tiposervicio: TipoServicio
                    }
                }
                $scope.Lista_OrdenTrabajo_CortesReconexiones = [];
                $http(variables)
                .success(function (data) {
                    $scope.Lista_OrdenTrabajo_CortesReconexiones = data;
                    $('.sige-load').hide();
                })
                .error(function () {
                    $('.sige-load').hide();
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };


            ///PREVISUALIZACION DESCARGAR

            $scope.DescargaPrevisualizacion = function () {

                var TipoServicio = document.getElementById('cbo_servicio').value;
                var fechaMovil = document.getElementById('_fechaEnvioMovil').value;

                var flag_marco = false;
                var List_codigos = [];

                flag_marco = MarcoCheck(TipoServicio);
                if (flag_marco == false) {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione al menos un registro.',
                        type: 'error'
                    });
                    return;
                }

                List_codigos = ListaMarcoCheck(TipoServicio);

                var variables = {
                    method: 'POST',
                    url: '../LecturaEnviarCliente/DescargaListaPreVisualizaEnvio',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        fechamovil: fechaMovil,
                        tipoServicio: TipoServicio,
                        List_codigos: List_codigos
                    }
                }
                $http(variables)
                .success(function (__a) {
                    window.open('/Lecturas/Temp/' + __a.__a, '_blank');
                }).error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            }

           //// PREVISUALIZACION

            $scope.tableToExcel_Historico = function (tableId) {

                var TipoServicio = document.getElementById('cbo_servicio').value;
                var nameDoc = '';
                if (TipoServicio == 1) {
                    nameDoc = 'HistoricoLectura.xls';
                } else if (TipoServicio == 2) {
                    nameDoc = 'HistoricoRelectura.xls';
                } else if (TipoServicio == 3) {
                    nameDoc = 'HistoricoCortes.xls';
                }

                var uri = 'data:application/vnd.ms-excel;base64,',
                        template = '<html lang="es" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Historico</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',
                        base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))); },
                        format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) };

                var table = $(tableId),
                             ctx = { worksheet: 'descar123', table: table.html() };

                var link = document.createElement("a");
                link.download = nameDoc,
                link.href = uri + base64(format(template, ctx));
                link.click()

            }



            $scope.tableToExcel_Pendientes = function (tableId) {

                var TipoServicio = document.getElementById('cbo_servicio').value;
                var nameDoc = '';
                if (TipoServicio == 1) {
                    nameDoc = 'PendienteLectura.xls';
                } else if (TipoServicio == 2) {
                    nameDoc = 'PendienteRelectura.xls';
                } else if (TipoServicio == 3) {
                    nameDoc = 'PendienteCortes.xls';
                } else if (TipoServicio == 4) {
                    nameDoc = 'PendienteReconexiones.xls';
                }

                var uri = 'data:application/vnd.ms-excel;base64,',
                        template = '<html lang="es" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Visualizacion de Pendientes</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',
                        base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))); },
                        format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) };

                var table = $(tableId),
                             ctx = { worksheet: 'descar123', table: table.html() };

                var link = document.createElement("a");
                link.download = nameDoc,
                link.href = uri + base64(format(template, ctx));
                link.click()

            }


            $scope.tableToExcel_Pendientes_Detallado = function (tableId) {

                var TipoServicio = document.getElementById('cbo_servicio').value;
                var nameDoc = '';
                if (TipoServicio == 1) {
                    nameDoc = 'Detalle_PendienteLectura.xls';
                } else if (TipoServicio == 2) {
                    nameDoc = 'Detalle_PendienteRelectura.xls';
                } else if (TipoServicio == 3) {
                    nameDoc = 'Detalle_PendienteCortes.xls';
                } else if (TipoServicio == 4) {
                    nameDoc = 'Detalle_PendienteReconexiones.xls';
                }

                var uri = 'data:application/vnd.ms-excel;base64,',
                        template = '<html lang="es" xmlns:o="urn:schemas-microsoft-com:office:office" xmlns:x="urn:schemas-microsoft-com:office:excel" xmlns="http://www.w3.org/TR/REC-html40"><head><meta charset="utf-8"><!--[if gte mso 9]><xml><x:ExcelWorkbook><x:ExcelWorksheets><x:ExcelWorksheet><x:Name>Visualizacion de Pendientes</x:Name><x:WorksheetOptions><x:DisplayGridlines/></x:WorksheetOptions></x:ExcelWorksheet></x:ExcelWorksheets></x:ExcelWorkbook></xml><![endif]--></head><body><table>{table}</table></body></html>',
                        base64 = function (s) { return window.btoa(unescape(encodeURIComponent(s))); },
                        format = function (s, c) { return s.replace(/{(\w+)}/g, function (m, p) { return c[p]; }) };

                var table = $(tableId),
                             ctx = { worksheet: 'descar123', table: table.html() };

                var link = document.createElement("a");
                link.download = nameDoc,
                link.href = uri + base64(format(template, ctx));
                link.click()

            }

            $scope.Lista_PendientesLiquidaciones = [];

            $scope.VisualizarPendientes = function () {

                var TipoServicio = document.getElementById('cbo_servicio').value;
                var _fechaPendientes = document.getElementById('_fechaPendientes').value;

                if (TipoServicio == '0' || TipoServicio == "0") {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione un Servicio. Muchas gracias.',
                        type: 'error'
                    });
                    return false;
                }

                if (_fechaPendientes == '') {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor ingrese o seleccione una Fecha se Asignación. Muchas gracias.',
                        type: 'error'
                    });
                    return false ;
                }

                $('.sige-load').show();
                var variables = {
                    method: 'POST',
                    url: '../LecturaEnviarCliente/ListandoPendientes',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        fechaAsigna: _fechaPendientes,
                        TipoServicio: TipoServicio
                    }
                }
                $http(variables)
                    .success(function (data) {
                        $('.sige-load').hide();
                        $scope.Lista_PendientesLiquidaciones = [];
                        if (oTablePendiente == null) {
                            $scope.Lista_PendientesLiquidaciones = data;
                        } else {
                            oTablePendiente.destroy();
                            oTablePendiente = null;
                            $scope.Lista_PendientesLiquidaciones = data;
                        }

                    }).error(function () {
                        $('.sige-load').hide();
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            }

            $scope.VisualizarModalPendientes = function () {

                var TipoServicio = document.getElementById('cbo_servicio').value;
                var _fechaPendientes = document.getElementById('_fechaPendientes');
                _fechaPendientes.value = FechaActualSistema();


                console.log(FechaActualSistema())
                if (TipoServicio == '0' || TipoServicio == "0") {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione un Servicio. Muchas gracias.',
                        type: 'error'
                    });
                    return false;
                }
                if (oTablePendiente == null) {
                    $scope.Lista_PendientesLiquidaciones = [];
                } else {
                    oTablePendiente.clear();
                    oTablePendiente.destroy();
                    oTablePendiente = null;
                    $scope.Lista_PendientesLiquidaciones = [];
                }

                $('#modal_VisualizarPendientes').modal({ show: 'false' });

            }


            $scope.Lista_Detallado_PendientesLiquidaciones = [];
            $scope.Visualizar_DetalladoPendientes = function (obj_datos) {

                var TipoServicio = document.getElementById('cbo_servicio').value;

                if (TipoServicio == '0' || TipoServicio == "0") {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione un Servicio. Muchas gracias.',
                        type: 'error'
                    });
                    return false;
                }

                if (oTablePendiente_Det == null) {
                    $scope.Lista_Detallado_PendientesLiquidaciones = [];
                } else {
                    oTablePendiente_Det.clear();
                    oTablePendiente_Det.destroy();
                    oTablePendiente_Det = null;
                    $scope.Lista_Detallado_PendientesLiquidaciones = [];
                }

                $('.sige-load').show();

                var variables = {
                    method: 'POST',
                    url: '../LecturaEnviarCliente/Listando_Detalles_Pendientes',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        TipoServicio: TipoServicio,
                        id_operario :obj_datos.id_operario,
                        id_estado: obj_datos.Estado,
                        fechaAsigna: obj_datos.fechaAsignacion
                    }
                }
                $http(variables)
                    .success(function (data) {
                        $('.sige-load').hide();

                        $scope.Lista_Detallado_PendientesLiquidaciones = [];
                        if (oTablePendiente_Det == null) {
                               $scope.Lista_Detallado_PendientesLiquidaciones = data;
                        } else {
                                oTablePendiente_Det.destroy();
                                oTablePendiente_Det = null;
                            $scope.Lista_Detallado_PendientesLiquidaciones = data;
                        }

                    }).error(function () {
                        $('.sige-load').hide();
                        alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            }


            $scope.DescargarArchivos = function () {

                var flag_marco = false;
                var List_codigos = [];
                var Cant_Reg = 0;

                var TipoServicio = document.getElementById('cbo_servicio').value;

                flag_marco = MarcoCheck(TipoServicio);
                if (flag_marco == false) {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione al menos un registro.',
                        type: 'error'
                    });
                    return;
                }

                List_codigos = ListaMarcoCheck(TipoServicio);
                Cant_Reg = List_codigos.length;

                $('.sige-load').show();
                var variables = {
                    method: 'POST',
                    url: '../LecturaEnviarCliente/ListandoFotosDescargar',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        List_codigos: List_codigos.toString(),
                        servicio: TipoServicio,
                        flag_multiple: Cant_Reg
                    }
                }
                $http(variables)
                .success(function (data) {
                    $('.sige-load').hide();
                    var res = data.split("|");
                    if (res[0].replace(/["]/gi, '') == "0" || res[0].replace(/["]/gi, '') == 0) {
                        alert(res[1]);
                    }
                    else if (res[0].replace(/["]/gi, '') == "2" || res[0].replace(/["]/gi, '') == 2) {
                        var url = res[1].replace(/["]/gi, '');
                        SavePhoto_II(url);
                    }
                    else {
                        var url = res[1].replace(/["]/gi, '');
                        window.open(url);
                    }

                }).error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            }


            $scope.DescargarArchivos_sinObservacion = function () {

                var flag_marco = false;
                var List_codigos = [];
                var Cant_Reg = 0;

                var TipoServicio = document.getElementById('cbo_servicio').value;
                if (TipoServicio == 1 || TipoServicio == '1' || TipoServicio == 2 || TipoServicio == '2') {

                    flag_marco = MarcoCheck(TipoServicio);
                    if (flag_marco == false) {
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Por favor seleccione al menos un registro.',
                            type: 'error'
                        });
                        return;
                    }


                    (new PNotify({
                        title: 'Sistemas Confirmación ',
                        text: 'Esta por descargar las fotos sin Observación, esta seguro ?',
                        icon: 'glyphicon glyphicon-question-sign',
                        hide: false,
                        confirm: {
                            confirm: true
                        },
                        buttons: {
                            closer: false,
                            sticker: false
                        },
                        history: {
                            history: false
                        }
                    })).get().on('pnotify.confirm', function () {

                        List_codigos = ListaMarcoCheck(TipoServicio);
                        Cant_Reg = List_codigos.length;

                        $('.sige-load').show();
                        var variables = {
                            method: 'POST',
                            url: '../LecturaEnviarCliente/ListandoFotosDescargar_sinObservacion',
                            headers: {
                                'Content-Type': 'application/json; charset=utf-8'
                            },
                            data: {
                                List_codigos: List_codigos.toString(),
                                servicio: TipoServicio,
                                flag_multiple: Cant_Reg
                            }
                        }
                        $http(variables)
                            .success(function (data) {
                                $('.sige-load').hide();
                                var res = data.split("|");
                                if (res[0].replace(/["]/gi, '') == "0" || res[0].replace(/["]/gi, '') == 0) {
                                    alert(res[1]);
                                }
                                else if (res[0].replace(/["]/gi, '') == "2" || res[0].replace(/["]/gi, '') == 2) {
                                    var url = res[1].replace(/["]/gi, '');
                                    SavePhoto_II(url);
                                }
                                else {
                                    var url = res[1].replace(/["]/gi, '');
                                    window.open(url);
                                }

                            }).error(function () {
                                alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                            });

                    }).on('pnotify.cancel', function () {
                        $('.sige-load').hide();
                    });

                }
            }

            function SavePhoto_II(fotourl) {
                window.open(fotourl);
            }

            //function SavePhoto(item) {
            //    var nameFoto = item.nombreFoto.split("_");
            //    nameFoto = nameFoto[0];
            //    //nameFoto = nameFoto + '_' + item.cuenta_contrato + '.jpg'
            //    nameFoto =  item.cuenta_contrato + '_' + item.fecha + '_' +   nameFoto + '.jpg'

            //    var link = document.createElement('a');
            //    link.href = item.fotourl;
            //    link.download = nameFoto;
            //    document.body.appendChild(link);
            //    link.click();
            //}

            $scope.Previsualizacion = function () {

                var TipoServicio = document.getElementById('cbo_servicio').value;
                var fechaMovil = document.getElementById('_fechaEnvioMovil').value;

                var flag_marco = false;
                var List_codigos = [];

                flag_marco = MarcoCheck(TipoServicio);
                if (flag_marco == false) {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione al menos un registro.',
                        type: 'error'
                    });
                    return;
                }

                List_codigos = ListaMarcoCheck(TipoServicio);

                var variables = {
                    method: 'POST',
                    url: '../LecturaEnviarCliente/Previsualizacion',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        fechamovil: fechaMovil,
                        tipoServicio: TipoServicio,
                        List_codigos: List_codigos
                    }
                }
                $http(variables)
                .success(function (data) {
                    var res = data.split('|');
                    if (res[0] == 0 || res[0] == "0") {
                        console.log(res[1])
                    } else {
                        $("#modal-envioAppMovil").modal('hide');
                        $scope.ListandoInformacionOrdenesTrabajo();
                    }
                }).error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            }

            function MarcoCheck(tipoServicio) {
                var flag_marco = false;

                if (tipoServicio == 1 || tipoServicio == 2 || tipoServicio == 9) { // lectura Relectura
                    for (var i = 0; i < $scope.ListaLecturasRelectura.length; i++) {
                        if ($scope.ListaLecturasRelectura[i].checkeado == true) {
                            flag_marco = true;
                            break;
                        }
                    }
                } else if (tipoServicio == 3 || tipoServicio == 4) { // lectura Cortes Reconexion
                    for (var i = 0; i < $scope.ListaCortes.length; i++) {
                        if ($scope.ListaCortes[i].checkeado == true) {
                            flag_marco = true;
                            break;
                        }
                    }
                }
                else if (tipoServicio == 6) { // Repartos
                    for (var i = 0; i < $scope.ListaReparto.length; i++) {
                        if ($scope.ListaReparto[i].checkeado == true) {
                            flag_marco = true;
                            break;
                        }
                    }
                }
                return flag_marco;
            }

            function ListaMarcoCheck(tipoServicio) {
                var List_id = [];

                if (tipoServicio == 1 || tipoServicio == 2 || tipoServicio == 9) { // lectura Relectura
                    for (var i = 0; i < $scope.ListaLecturasRelectura.length; i++) {
                        if ($scope.ListaLecturasRelectura[i].checkeado == true) {
                            List_id.push($scope.ListaLecturasRelectura[i].id_Lectura)
                        }
                    }
                } else if (tipoServicio == 3 || tipoServicio == 4) { // Cortes Reconexiones
                    for (var i = 0; i < $scope.ListaCortes.length; i++) {
                        if ($scope.ListaCortes[i].checkeado == true) {
                            List_id.push($scope.ListaCortes[i].id_Lectura)
                        }
                    }
                }
                else if (tipoServicio ==6) { // Repartos
                    for (var i = 0; i < $scope.ListaReparto.length; i++) {
                        if ($scope.ListaReparto[i].checkeado == true) {
                            List_id.push($scope.ListaReparto[i].id_Reparto)
                        }
                    }
                }
                return List_id;
            }

            function FechaActualSistema() {
                var today = new Date();
                var dd = today.getDate();
                var mm = today.getMonth() + 1;

                var yyyy = today.getFullYear();
                if (dd < 10) {
                    dd = '0' + dd
                }
                if (mm < 10) {
                    mm = '0' + mm
                }
                var today = dd + '/' + mm + '/' + yyyy;

                return today;
            }
             

 


            $scope.myFileFoto = [];

            $scope.nuevaimportacion = function () {

                $(":file").filestyle('clear');
                $('#btn_ver').attr('disabled', false);
                $('#btn_guardar').attr('disabled', true);
                $('#btn_guardarVac').attr('disabled', true);

                if (oTable_alerta == null) {
                    $scope.ListaAlertas = [];
                } else {
                    oTable_alerta.clear();
                    oTable_alerta.destroy();
                    oTable_alerta = null;
                    $scope.ListaAlertas = [];
                }
            }
 


            $scope.uploadFile = function () {

                var idlocal = document.getElementById('cbo_local').value;
                var idfechaAsignacion = document.getElementById('dtp_fechaAsigna').value;
                var dtp_fecha_lectura = document.getElementById('dtp_fecha_lectura').value;
                var idServicio = document.getElementById('cbo_servicio').value;


                if (dtp_fecha_lectura == '' || dtp_fecha_lectura == undefined || dtp_fecha_lectura ==null) {
                    new PNotify({
                        title: ' ',
                        text: 'Por favor ingrese la fecha de lectura movil. Muchas gracias.',
                        type: 'error'
                    });
                    return;
                }


                if ($scope.myFile == null) {
                    new PNotify({
                        title: ' ',
                        text: 'Ningun Archivo Seleccionado..',
                        type: 'error'
                    });
                }

                else {

                    let mostrar_alertas = () => {
                        $scope.ListaAlertas = [];

                        document.getElementById("form_cabecera").style.display = "none";
                        $('.sige-load').show();
                        var variables = {
                            method: 'post',
                            url: '../LecturaEnviarCliente/get_alertas_lecturas',
                            headers: {
                                'Content-Type': 'application/json; charset=utf-8'
                            },
                            data: {
                                fecha_asignacion: idfechaAsignacion
                            },
                        }
                        $http(variables)
                        .success(function (data) {

                            if (data.length == 0) {
                                $('.sige-load').hide();
                                document.getElementById("form_cabecera").style.display = "";
                            }

                            if (oTable_alerta == null) {
                                $scope.ListaAlertas = data;
                            } else {
                                oTable_alerta.clear();
                                oTable_alerta.destroy();
                                oTable_alerta = null;
                                $scope.ListaAlertas = data;
                            }
                         })
                        .error(function () {
                                alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                         });
                    }

                    $('#btn_ver').attr('disabled', true);
                    $('.sige-load').show();
                    var file = $scope.myFile;
                    var uploadUrl = '../DistribuirLecturas/Inserta_Excel_Lecturas';
                    var fd = new FormData();
                    fd.append('file', file);
                    fd.append('idlocal', 1);
                    fd.append('idfechaAsignacion', idfechaAsignacion);
                    fd.append('idServicio', idServicio);
                    fd.append('fecha_lectura', dtp_fecha_lectura);

                    $http.post(uploadUrl, fd,
                    {
                        transformRequest: angular.identity,
                        headers: { 'Content-Type': undefined }
                    }).success(function (data) {
                        $('.sige-load').hide();
                        var res = data.split("|");
                        if (res[0] == '-1' || res[0] == '"-1"' || res[0] == '"-1') {
                            alert(data);
                        }
                        else if (res[0] == '0' || res[0] == '"0"' || res[0] == '"0') {
                            new PNotify({
                                title: 'Sistemas',
                                text: "Existen Cod. Observacion incorrectos, verifique : " + res[1],
                                type: 'error'
                            });
                        }
                        else if (res[0] == '1' || res[0] == '"1"' || res[0] == '"1') {
                            new PNotify({
                                title: 'Sistemas',
                                text: res[1],
                                type: 'info'
                            });
                        }
                        else if (res[0] == '2' || res[0] == '"2"' || res[0] == '"2') {
                            new PNotify({
                                title: 'Sistemas',
                                text: 'Guardado realizado Correctamente.',
                                type: 'success'
                            });

                            mostrar_alertas();
                            $('#btn_guardar').attr('disabled', false);
                            $('#btn_guardarVac').attr('disabled', false);
                        }
                    })
                    .error(function () {
                        alert('Ocurrio un problema con la conexion, vuelva a intentar.')
                        $('.sige-load').hide();
                    });
                }
            };

            $scope.Actualizar_Lecturas = function () {
                var idfechaAsignacion = document.getElementById('dtp_fechaAsigna').value;
                if ($scope.myFile == null) {
                    new PNotify({
                        title: ' ',
                        text: 'Ningun Archivo Seleccionado..',
                        type: 'error'
                    });
                }

                else {
                    $scope.ListaAlertas = [];
                    let mostrar_alertas = () => {
                        document.getElementById("form_cabecera").style.display = "none";
                        $('.sige-load').show();
                        var variables = {
                            method: 'post',
                            url: '../LecturaEnviarCliente/get_alertas_lecturas',
                            headers: {
                                'Content-Type': 'application/json; charset=utf-8'
                            },
                            data: {
                                fecha_asignacion: idfechaAsignacion
                            },
                        }
                        $http(variables)
                            .success(function (data) {

                                if (data.length == 0) {
                                    $('.sige-load').hide();
                                    document.getElementById("form_cabecera").style.display = "";
                                }

                                if (oTable_alerta == null) {
                                    $scope.ListaAlertas = data;
                                } else {
                                    oTable_alerta.clear();
                                    oTable_alerta.destroy();
                                    oTable_alerta = null;
                                    $scope.ListaAlertas = data;
                                }
                            })
                            .error(function () {
                                alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                            });
                    }

                    var variablesG = {
                        method: 'post',
                        url: '../LecturaEnviarCliente/Proceso_Almacenar_lecturas',
                        headers: {
                            'Content-Type': 'application/json; charset=utf-8'
                        }
                    }
                    $http(variablesG)
                        .success(function (data) {
                            if (data == '"OK"' || data == '"OK' || data == 'OK') {
                                mostrar_alertas();
                            } else {
                                alert(data);
                            }
                        })
                        .error(function () {
                            alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                        });

                }
            };

            var objFotoLecturaG;
 

            $scope.Actualizar_Lecturas_Vacias = function () {

                var idfechaAsignacion = document.getElementById('dtp_fechaAsigna').value;
                if ($scope.myFile == null) {
                    new PNotify({
                        title: ' ',
                        text: 'Ningun Archivo Seleccionado..',
                        type: 'error'
                    });
                }

                else {
                    (new PNotify({
                        title: 'Sistemas Confirmación ',
                        text: 'Esta seguro de Guardar las lecturas, aunque la lectura anterior este vacia..?',
                        icon: 'glyphicon glyphicon-question-sign',
                        hide: false,
                        confirm: {
                            confirm: true
                        },
                        buttons: {
                            closer: false,
                            sticker: false
                        },
                        history: {
                            history: false
                        }
                    })).get().on('pnotify.confirm', function () {

                        $scope.ListaAlertas = [];
                        let mostrar_alertas = () => {
                            document.getElementById("form_cabecera").style.display = "none";
                            $('.sige-load').show();
                            var variables = {
                                method: 'post',
                                url: '../LecturaEnviarCliente/get_alertas_lecturas',
                                headers: {
                                    'Content-Type': 'application/json; charset=utf-8'
                                },
                                data: {
                                    fecha_asignacion: idfechaAsignacion
                                },
                            }
                            $http(variables)
                                .success(function (data) {

                                    if (data.length == 0) {
                                        $('.sige-load').hide();
                                        document.getElementById("form_cabecera").style.display = "";
                                    }

                                    if (oTable_alerta == null) {
                                        $scope.ListaAlertas = data;
                                    } else {
                                        oTable_alerta.clear();
                                        oTable_alerta.destroy();
                                        oTable_alerta = null;
                                        $scope.ListaAlertas = data;
                                    }
                                })
                                .error(function () {
                                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                                });
                        }

                        var variablesG = {
                            method: 'post',
                            url: '../LecturaEnviarCliente/Proceso_Almacenar_lecturas_vacias',
                            headers: {
                                'Content-Type': 'application/json; charset=utf-8'
                            }
                        }
                        $http(variablesG)
                            .success(function (data) {
                                if (data == '"OK"' || data == '"OK' || data == 'OK') {
                                    mostrar_alertas();
                                } else {
                                    alert(data);
                                }
                            })
                            .error(function () {
                                alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                            });


                    }).on('pnotify.cancel', function () {

                    });
                }
            };

            $scope.DescargaExcel_EnvioCliente = function () {
                if (ValidacionesGenerales() == false) {
                    return;
                }
                var id_link = document.getElementById('id_link');
                var cbo_local = document.getElementById('cbo_local');
                var cbo_servicio = document.getElementById('cbo_servicio');
                var cbo_estado = document.getElementById('cbo_estado');
                var txt_suministro = document.getElementById('txt_suministro');
                var txt_medidor = document.getElementById('txt_medidor');
                var cbo_tecnico = document.getElementById('cbo_tecnico');
                var dtp_fechaAsigna = document.getElementById('dtp_fechaAsigna');

                var cbo_supervisor = document.getElementById('cbo_supervisor').value;
                var cbo_Operario_supervisor = document.getElementById('cbo_Operario_supervisor').value;

                if (cbo_servicio.value == 1 || cbo_servicio.value == '1') {
                    if (cbo_supervisor == '' || cbo_supervisor == '-1' || cbo_supervisor == -1) {
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Por favor seleccione un supervisor',
                            type: 'error'
                        });
                        return;
                    }
                }

                var urlPage = '';
                if (cbo_servicio.value == 1 || cbo_servicio.value == 2 || cbo_servicio.value == 9) {
                    urlPage = '../LecturaEnviarCliente/DescargarArchivoTexto_EnvioCliente';
                }
                else if (cbo_servicio.value == 3 || cbo_servicio.value == 4) {
                    urlPage = '../LecturaEnviarCliente/DescargarArchivoTexto_CorteReconexiones';

                    //$('#modalCorteReconexion').modal({ show: 'false' });
                    $('#modalCorteReconexion').modal('show');

                    $scope.nombreServicio = $("#cbo_servicio option:selected").text();

                    setTimeout(function () {
                        $('#cbo_tipoReporte').val('0').trigger('change');
                    }, 200);

                    return
                }
                else {
                    urlPage = '../LecturaEnviarCliente/DescargaExcel_EnviarCliente';
                }

                $('.sige-load').show();
                var variables = {
                    method: 'post',
                    url: urlPage,
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        id_local: 1,
                        id_tipo_servicio: cbo_servicio.value,
                        estado: cbo_estado.value,
                        suministro: txt_suministro.value,
                        medidor: txt_medidor.value,
                        tecnico: cbo_tecnico.value,
                        fechaAsignacion: dtp_fechaAsigna.value,
                        id_supervisor: cbo_supervisor,
                        id_operario_supervisor: cbo_Operario_supervisor
                    }
                }

                $http(variables)
                .success(function (data) {
                    var res = data.split("|");
                    if (cbo_servicio.value == 1 || cbo_servicio.value == 2 || cbo_servicio.value == 9 || cbo_servicio.value == 3 || cbo_servicio.value == 4) {
                        if (res[0].replace(/["]/gi, '') == 0 || res[0].replace(/["]/gi, '') == "0") {
                            new PNotify({
                                title: 'Sistemas',
                                text: 'No hay información para mostrar.',
                                type: 'success'
                            });
                        } else if (res[0].replace(/["]/gi, '') == -1 || res[0].replace(/["]/gi, '') == "-1") {
                            alert(res[1]);
                        }
                        else {
                             let url = res[1].replace(/["]/gi, '');
                            //window.open(url);
                            id_link.href = res[1].replace(/["]/gi, '');
                            id_link.click();
                        }
                    } else {
                        if (res[0].replace(/["]/gi, '') == "0" || res[0].replace(/["]/gi, '') == 0){
                            new PNotify({
                                title: 'Sistemas',
                                text: 'No hay información para mostrar.',
                                type: 'success'
                            });
                        }
                        else if (res[0].replace(/["]/gi, '') == "-1" || res[0].replace(/["]/gi, '') == -1) {
                            alert(res[1]);
                        } else {
                            var url = res[1].replace(/["]/gi, '');
                            window.open(url);
                        }
                    }
                    $('.sige-load').hide();
                })
                .error(function () {
                    $('.sige-load').hide();
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            };

            $scope.DescargaExcel_EnvioCliente_CorteReconexion = function () {

                var id_link = document.getElementById('id_link');
                var cbo_servicio = document.getElementById('cbo_servicio');
                var cbo_estado = document.getElementById('cbo_estado');
                var cbo_tecnico = document.getElementById('cbo_tecnico');
                var dtp_fechaAsigna = document.getElementById('dtp_fechaAsigna');
                var cbo_tipoReporte = document.getElementById('cbo_tipoReporte').value;

                if (cbo_tipoReporte == 0 || cbo_tipoReporte == '0') {
                    new PNotify({
                        title: ' ',
                        text: 'Por favor seleccione un Tipo de Reporte',
                        type: 'error'
                    });
                }

                let  urlPage = '../LecturaEnviarCliente/DescargarArchivoTexto_CorteReconexiones';

                $('.sige-load').show();
                var variables = {
                    method: 'post',
                    url: urlPage,
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        id_tipo_servicio: cbo_servicio.value,
                        estado: cbo_estado.value,
                        tecnico: cbo_tecnico.value,
                        fechaAsignacion: dtp_fechaAsigna.value,
                        tipo: cbo_tipoReporte
                    }
                }

                $http(variables)
                    .success(function (data) {
                        $('.sige-load').hide();

                        var res = data.split("|");
                        if (res[0].replace(/["]/gi, '') == 0 || res[0].replace(/["]/gi, '') == "0") {
                            new PNotify({
                                title: 'Sistemas',
                                text: 'No hay información para mostrar.',
                                type: 'success'
                            });
                        } else if (res[0].replace(/["]/gi, '') == -1 || res[0].replace(/["]/gi, '') == "-1") {
                            alert(res[1]);
                        }
                        else {

                            $("#modalCorteReconexion").modal('hide');
                            let url = res[1].replace(/["]/gi, '');
                            id_link.href = res[1].replace(/["]/gi, '');
                            id_link.click();
                        }

                    })
                    .error(function () {
                        $('.sige-load').hide();
                        alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                    });
            };


            $scope.Descargar_texto_EnvioCliente = function () {
                var id_link = document.getElementById('id_link');
                var cbo_local = document.getElementById('cbo_local').value;
                var cbo_servicio = document.getElementById('cbo_servicio').value;
                var cbo_estado = document.getElementById('cbo_estado').value;
                var dtp_fechaAsigna = document.getElementById('dtp_fechaAsigna').value;

                //if (cbo_local == '' || cbo_local == 0 || cbo_local == null || cbo_local == undefined) {
                //    new PNotify({
                //        title: 'Sistemas',
                //        text: 'Por favor seleccione el Local, Muchas gracias',
                //        type: 'error'
                //    });
                //    return;
                //}
                if (cbo_servicio == '' || cbo_servicio == 0 || cbo_servicio == null || cbo_servicio == undefined) {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione el Servicio, Muchas gracias',
                        type: 'error'
                    });
                    return;
                }

                if (cbo_estado == '' || cbo_estado == 0 || cbo_estado == null || cbo_estado == undefined) {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione el Estado',
                        type: 'error'
                    });
                    return;
                }


                if (dtp_fechaAsigna == '' || dtp_fechaAsigna == 0 || dtp_fechaAsigna == null || dtp_fechaAsigna == undefined) {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor ingrese o seleccione la Fecha de Asignacion.',
                        type: 'error'
                    });
                    return;
                }

                var cbo_local = document.getElementById('cbo_local').value;
                var cbo_servicio = document.getElementById('cbo_servicio').value;
                var cbo_estado = document.getElementById('cbo_estado').value;
                var dtp_fechaAsigna = document.getElementById('dtp_fechaAsigna').value;

                $('.sige-load').show();
                var variables = {
                    method: 'POST',
                    url: '../EnviarTrabajoCliente_LDS/DescargarArchivo_EnvioCliente',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        local: 1,
                        servicio: cbo_servicio,
                        estado: cbo_estado,
                        fechaAsigna: dtp_fechaAsigna,

                    }
                }
                $http(variables)
                .success(function (data) {
                    $('.sige-load').hide();



                })
                .error(function () {
                    $('.sige-load').hide();
                    alert('Ocurrio un problema con la conexion, vuelva a intentar.')
                });

            }
 
            $scope.checkePendientes = false;
            $scope.EnviarVerificacion_porcentaje = function () {

                var flag_marco = false;
                var List_codigos = [];
                var Cant_Reg = 0;
                var TipoServicio = document.getElementById('cbo_servicio').value;

                if (TipoServicio == 3 || TipoServicio == 4) {
                    return;
                }

                flag_marco = MarcoCheck(TipoServicio);
                if (flag_marco == false) {
                    new PNotify({
                        title: 'Sistemas',
                        text: 'Por favor seleccione al menos un registro.',
                        type: 'error'
                    });
                    return;
                }

                List_codigos = ListaMarcoCheck(TipoServicio);

                $('.sige-load').show();
                var variables = {
                    method: 'POST',
                    url: '../LecturaEnviarCliente/Proceso_Verificacion_Porcentaje',
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        List_codigos: List_codigos.toString(),
                        servicio: TipoServicio
                    }
                }
                $http(variables)
                .success(function (data) {
                    $('.sige-load').hide();
                    if (data == '"Ok"') {
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Proceso realizado, correctamente.',
                            type: 'success'
                        });
                        //---refrescando la informacion de las lectuas...
                        $scope.ListandoInformacionOrdenesTrabajo();


                    } else {
                        alert(data);
                    }
                }).error(function () {
                    alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                });
            }

            $scope.verPendientes = function (opcion) {

                $('.sige-load').show();
                var input, filter, table, tr, td,td2, i, filtro;
                var tabla = document.getElementById('tblLecturasRelecturas');
                var chk_pendientes = document.getElementById('chk_pendientes').checked;
                tr = tabla.getElementsByTagName("tr");

                if (opcion == true) {
                    filtro = 'SI';
                } else {
                    filtro = '';
                }

                for (i = 0; i < tr.length; i++) {
                    td = tr[i].getElementsByTagName("td")[14]
                    if (td) {
                        if (td.innerHTML.toUpperCase().indexOf(filtro) > -1) {
                            tr[i].style.display = "";
                        } else {
                            td2 = tr[i].getElementsByTagName("td")[15]
                            if (td2) {
                                if (td2.innerHTML.toUpperCase().indexOf(filtro) > -1) {
                                    tr[i].style.display = "";
                                } else {
                                    tr[i].style.display = "none";
                                }
                            }
                        }
                    }
                }

                $timeout(function () {
                    $('.sige-load').hide();
                },500)

            }

            $scope.KeyDown_Lectura = function (keyEvent, obj_datos, id_enfoque) {
                if (keyEvent.which === 13) {
                   var variables = {
                        method: 'post',
                       url: '../LecturaEnviarCliente/Proceso_Actualizar_lecturas',
                        headers: {
                            'Content-Type': 'application/json; charset=utf-8'
                        },
                        data: {
                            id_lectura: obj_datos.id_Lectura,
                            valor_lectura: obj_datos.lectura_movil
                        }
                    }
                    $http(variables)
                        .success(function (data) {
                            if (data == '"OK"' || data == '"OK' || data == 'OK') {
                                //----realizando el tab siguiente  registro
                                $scope.changeFocusInput('id_' + (parseInt(id_enfoque) + 1))
                            } else {
                                alert(data);
                            }
                        })
                        .error(function () {
                            alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                        });
                }
            }

            $scope.changeFocusInput = function (id) {
                var doc = document.getElementById(id);
                doc.focus();
            }
  
            $scope.Generate_Relectura = function () {
                var local = document.getElementById('cbo_local').value;
                var servicios = document.getElementById('cbo_servicio').value;
                var fechaAsignacion = document.getElementById('dtp_fechaAsigna').value;

                if (servicios == "0") {
                    new PNotify({
                        title: ' ',
                        text: 'Por favor seleccione un Servicio. Muchas gracias.',
                        type: 'error'
                    });
                    return;
                }
                if (servicios > 1) {
                    return;
                }

                //if (local == "0") {
                //    new PNotify({
                //        title: ' ',
                //        text: 'Por favor seleccione un Local. Muchas gracias.',
                //        type: 'error'
                //    });
                //    return;
                //}
                if (fechaAsignacion == '') {
                    new PNotify({
                        title: ' ',
                        text: 'Por favor seleccione o ingrese una Fecha de Asignación. Muchas gracias.',
                        type: 'error'
                    });
                    return;
                }
                $('.sige-load').show();

                (new PNotify({
                    title: 'Sistemas Confirmación ',
                    text: 'Verifique la fecha de Asignación, la Fecha ( ' + fechaAsignacion + ' ) es la correcta, porque se procedera a Cerrar las Lecturas..',
                    icon: 'glyphicon glyphicon-question-sign',
                    hide: false,
                    confirm: {
                        confirm: true
                    },
                    buttons: {
                        closer: false,
                        sticker: false
                    },
                    history: {
                        history: false
                    }
                })).get().on('pnotify.confirm', function () {


                    var variables = {
                        method: 'post',
                        url: '../LecturaEnviarCliente/set_generando_relectura',
                        headers: {
                            'Content-Type': 'application/json; charset=utf-8'
                        },
                        data: {
                            id_servicio: servicios,
                            fecha_Asignacion: fechaAsignacion
                        }
                    }

                    $http(variables)
                        .success(function (data) {
                            $('.sige-load').hide();
                            console.log(data);
                            if (data == "OK" || data == '"OK"') {
                                new PNotify({
                                    title: 'Sistemas',
                                    text: 'Proceso realizado, correctamente.',
                                    type: 'success'
                                });
                            } else {
                                alert(data);
                            }
                        })
                        .error(function () {
                            $('.sige-load').hide();
                            alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                        });

                }).on('pnotify.cancel', function () {
                    $('.sige-load').hide();
                });


            }

            $scope.Descargar_EnvioCliente_Relectura = function () {
                if (ValidacionesGenerales() == false) {
                    return;
                }
                var id_link = document.getElementById('id_link');
                var cbo_local = document.getElementById('cbo_local');
                var cbo_servicio = document.getElementById('cbo_servicio');
                var cbo_estado = document.getElementById('cbo_estado');
                var txt_suministro = document.getElementById('txt_suministro');
                var txt_medidor = document.getElementById('txt_medidor');
                var cbo_tecnico = document.getElementById('cbo_tecnico');
                var dtp_fechaAsigna = document.getElementById('dtp_fechaAsigna');

                var cbo_supervisor = document.getElementById('cbo_supervisor').value;
                var cbo_Operario_supervisor = document.getElementById('cbo_Operario_supervisor').value;

                if (cbo_servicio.value == 1 || cbo_servicio.value == '1') {
                    if (cbo_supervisor == '' || cbo_supervisor == '-1' || cbo_supervisor == -1) {
                        new PNotify({
                            title: 'Sistemas',
                            text: 'Por favor seleccione un supervisor',
                            type: 'error'
                        });
                        return;
                    }
                }

                var urlPage = '';
                urlPage = '../LecturaEnviarCliente/DescargarArchivoTexto_EnvioCliente_relectura';

                $('.sige-load').show();
                var variables = {
                    method: 'post',
                    url: urlPage,
                    headers: {
                        'Content-Type': 'application/json; charset=utf-8'
                    },
                    data: {
                        id_local: 1,
                        id_tipo_servicio: cbo_servicio.value,
                        estado: cbo_estado.value,
                        suministro: txt_suministro.value,
                        medidor: txt_medidor.value,
                        tecnico: cbo_tecnico.value,
                        fechaAsignacion: dtp_fechaAsigna.value,
                        id_supervisor: cbo_supervisor,
                        id_operario_supervisor: cbo_Operario_supervisor
                    }
                }
                $http(variables)
                    .success(function (data) {
                        var res = data.split("|");
                        if (res[0].replace(/["]/gi, '') == 0 || res[0].replace(/["]/gi, '') == "0") {
                            new PNotify({
                                title: 'Sistemas',
                                text: 'No hay información para mostrar.',
                                type: 'success'
                            });
                        } else if (res[0].replace(/["]/gi, '') == -1 || res[0].replace(/["]/gi, '') == "-1") {
                            alert(res[1]);
                        }
                        else {
                            let url = res[1].replace(/["]/gi, '');
                            id_link.href = res[1].replace(/["]/gi, '');
                            id_link.click();

                        }
                        $('.sige-load').hide();
                    })
                    .error(function () {
                        $('.sige-load').hide();
                        alert('Lo sentimos, Ocurrio un problema, vuelva a intentar.')
                    });
            };
            
            $scope.file = null;
            $scope.$watch('file', function (newVal) {
                if (newVal)
                    console.log(newVal);
            })


        })

        function fnParametros() {
            return {
                type: 'owner',
                sort: 'updated',
                direction: 'desc',
                per_page: 100,
                page: 1
            };
        }

        $(function () {
            $('.fixed-table-toolbar > .search').css('width', '170px');
            $('.fixed-table-toolbar > .search').addClass('input-group');
            /*<select class="form-control" onchange="fnBusca($(this))"><option value=""></option><option value=".Activo">Activo</option><option value=".Inactivo">Inactivo</option></select>*/
            $('.fixed-table-toolbar > .search').append('<div class="input-group-btn"><button type="button" class="btn btn-default btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" onclick="fnBusca(\'\')">Estado <span class="caret"></span></button><ul class="dropdown-menu"><li onclick="fnBusca(\'.Activo\')"><a href="javascript:">Activo</a></li><li onclick="fnBusca(\'.Inactivo\')"><a href="javascript:">Inactivo</a></li></ul></div>');
        })

        $(window).resize(function () {
            $('#table-registro').bootstrapTable('resetView');
        });

        function fnBusca(__a) {
            $('.fixed-table-toolbar > .search > input').val(__a);
            $('.fixed-table-toolbar > .search > input').trigger('keyup');
        }


    </script>
}

<div ng-app="appLecturaEnviarCliente" ng-controller="LecturaEnviarClienteCtrl" ng-init="listando_Locales()">

    <div class="panel panel-oscuro" style="margin-top: -14px;">
        <div class="panel-heading">
            <h6><i class="fa fa-table fa-lg"></i> VISUALIZAR FOTOS DE CORTES Y RECONEXIONES </h6>
        </div>
        <div class="panel-body">

            <div class="well" style="background: #314b75; color: white;    margin-bottom: 1px;">
                <div class="row" style="    margin-top: -15px">
                    <div class="col-xs-12 col-sm-12 ">
                        <div class="col-xs-6 col-sm-4 col-md-3  col-lg-3 " style="display:none">
                            <div class="form-group">
                                <label class="control-label">  Local </label>
                                <br />
                                <select id="cbo_local" class="form-control" ng-model="id_local" ng-change="Tecnico_Change(id_tipoServicio);">
                                    <option value=0>--[ Seleccione ]-- </option>
                                    <option ng-repeat="item in ListaLocales" value="{{item.loc_id}}">
                                        {{item.loc_nombre}}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="col-xs-6 col-sm-4 col-md-4 col-lg-4 ">
                            <div class="form-group">
                                <label class="control-label">   Servicios  </label>
                                <br />
                                <select id="cbo_servicio" class="form-control" ng-model="id_tipoServicio" ng-change="Tecnico_Change(id_tipoServicio); Servicios_Change(id_tipoServicio); ChangeObservaciones(id_tipoServicio); ">
                                    <option value=0>--[ Seleccione ]-- </option>
                                    <option ng-repeat="item in ListaServicios" value="{{item.id_TipoServicio}}">
                                        {{item.nombre_tiposervicio}}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="col-xs-12 col-sm-4 col-md-4  col-lg-4 ">
                            <div class="form-group">
                                <label class="control-label">    Estados </label>
                                <br />
                                <select id="cbo_estado" class="form-control">
                                    <option value=0>--[ Seleccione ]-- </option>
                                    <option ng-repeat="item in ListaEstados" value="{{item.id_Estado}}">
                                        {{item.descripcion_estado}}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="col-xs-12 col-sm-4 col-md-4  col-lg-4 ">
                            <div class="form-group form-group-sm">
                                <label class="control-label">   Fecha Asignación       </label>
                                <br />
                                <div class="input-group">
                                    <input class="form-control Julio" id="dtp_fechaAsigna" placeholder="dia/mes/año" type="text" value="@DateTime.Now.ToString("dd/MM/yyyy")" />
                                </div>
                            </div>
                        </div>
                    </div>

                    <a id="id_link" href="" download style="display:none">link</a>
                </div>

                <div class="row" style="    margin-bottom: -20px;">
                    <div class="col-sm-12">
                        <div class="col-xs-6 col-sm-6 col-md-3  col-lg-3 ">
                            <div class="form-group">
                                <label class="control-label">   Suministro  </label>
                                <br />
                                <input id="txt_suministro" class="form-control" type="text" placeholder="Ingresar Suministro">
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-6 col-md-3  col-lg-3 ">
                            <div class="form-group">
                                <label class="control-label">
                                    Medidor
                                </label>
                                <br />
                                <input id="txt_medidor" class="form-control" type="text" placeholder="Ingresar medidor" maxlength="30">
                            </div>
                        </div>
                        <div class="col-xs-6 col-sm-6 col-md-3  col-lg-3 ">
                            <div class="form-group">
                                <label class="control-label">
                                    Técnico Asignado
                                </label>
                                <br />
                                <select id="cbo_tecnico" class="form-control">
                                    <option value=0>--[ TODOS ]-- </option>
                                    <option ng-repeat="item in ListaTecnico" value="{{item.ope_id}}">
                                        {{item.ope_nombre}}
                                    </option>
                                </select>
                            </div>
                        </div>

                        <div class="col-sm-3 col-md-3 col-lg-3">
                            <br />
                            <div class="form-group">
                                <button class="btn btn-primary" ng-click="ListandoInformacionOrdenesTrabajo()"><span class="glyphicon glyphicon-refresh"></span> Actualizar</button>
                            </div>
                        </div>

                    </div>

                </div>

            </div>
                       
            <div id="Principal" class="table table-responsive">
                <table id="tblCortesReconexiones" class="table  table-responsive table-bordered  table-condensed" ng-show="Flag_Show_CorteReconexion ;" border="0" cellspacing="0" cellpadding="0" style="font-size:11px">
                    <thead style="background:#F0F3F5;">
                        <tr>
                            <th>
                                <div class="checkbox clip-check check-danger checkbox-inline">
                                    <input type="checkbox" id="checkboxAll" value="1" ng-model="checkedAll" ng-click="checkedAll_OrdenTrabajo(checkedAll,2)">
                                    <label for="checkboxAll">
                                    </label>
                                </div>
                            </th>
                            <th>Item</th>
                            <th>Orden</th>
                            <th>Foto</th>
                            <th>Fecha Corte</th>
                            <th>Cuenta Contrato</th>
                            <th>Medidor</th>
                            <th>Ubicacion Medidor</th>
                            <th>Lectura</th>
                            <th>Observación</th>
                            <th>Resultado</th>
                            <th>Operario</th>
                            <th>Dirección</th>
                            <th>Distrito</th>
                            <th></th>

                        </tr>
                    </thead>
                    <tbody>
                        <tr ng-repeat="item in ListaCortes">
                            <td>
                                <div class="checkbox clip-check check-primary checkbox-inline check">
                                    <input type="checkbox" id="checkbox{{$index}}" value="true" ng-model="item.checkeado" ng-click="addIdChecked(item.Numero_OrdImport,item.checked)">
                                    <label for="checkbox{{$index}}">
                                    </label>
                                </div>
                            </td>
                            <td>
                                {{$index + 1}}
                            </td>
                            <td>{{item.orden}}</td>
                            <td><a href="#" ng-click="MostrarFoto(item.id_Lectura, 2);">{{item.foto}}</a> </td>
                            <td>{{item.fecha_corte}}</td>
                            <td>{{item.cuenta_contrato}}</td>
                            <td>{{item.medidor_corte}}</td>
                            <td style="color:red">{{item.ubicacion_Medidor}}</td>
                            <td ng-click="ModificarCortesReconexiones(item,item.lectura, 'corte_lectura');" style="cursor: pointer"><a href=" #">{{item.lectura}}</a></td>
                            <td ng-click="ModificarCortesReconexiones(item,item.id_Observacion_corte, 'cod_observacion');" style="cursor: pointer"><a href=" #">{{item.observacion}}</a></td>
                            <td ng-click="ModificarCortesReconexiones(item,item.id_resultadoObsCorte, 'cod_observacionResultado');" style="cursor: pointer"><a href=" #">{{item.id_observacionResultado_corte}}</a></td>
                            <td>{{item.ope_nombre}}</td>
                            <td>{{item.direccion}}</td>
                            <td>{{item.distrito}}</td>
                            <td><a data-toggle="modal" data-target="#modal-historico_CortesReconexiones" ng-click="OrdenTrabajo_Historico_CortesReconexiones(item.suministro_corte);" href="#"> Histórico</a></td>

                        </tr>
                    </tbody>
                </table>   
            </div>
            
            <table id="tblTrabajos" style="display:none">
                <thead>
                    <tr>
                        <th>ITEM</th>
                        <th>INSTALACIÓN</th>
                        <th>EQUIPO</th>
                        <th>MEDIDOR</th>
                        <th>CTA.CTO</th>
                        <th>FECHA PLAN LECTURA</th>
                        <th>FECHA REAL DE LECTURA</th>
                        <th>HORA DE LECTURA REAL</th>
                        <th>LECTURA</th>
                        <th>NOTA DE LECTURISTA</th>
                        <th>CÓDIGO DE COMENTARIO</th>
                        <th>COMENTARIO</th>
                        <th>CODIGO DE LECTOR</th>
                    </tr>
                </thead>
                <tbody>
                    <tr ng-repeat="item in listTrabajos">
                        <td>{{item.ITEM}}</td>
                        <td>{{item.INSTALACION}}</td>
                        <td>{{item.EQUIPO}}</td>
                        <td>{{item.MEDIDOR}}</td>
                        <td>{{item.CTACTO}}</td>
                        <td>{{item.FecPlanLectura}}</td>
                        <td>{{item.FecRealPlanLectura}}</td>
                        <td>{{item.Hora_Plantilla}}</td>
                        <td>{{item.Lectura}}</td>
                        <td>{{item.Nota}}</td>
                        <td>{{item.Cod_Comentario}}</td>
                        <td>{{item.Comentario}}</td>
                        <td>{{item.Codigo_Lector}}</td>
                    </tr>
                </tbody>
            </table>
            <br />
            <div class="row">
                <div class="panel-body" style="height: 40px;">
                    <div class="col-sm-12" style="text-align:center;">
                        <div class="form-group form-group-sm">
                             <button role="button" class="btn btn-warning btn-sm" ng-click="DescargarArchivos();" title="Descargar Todas Fotos"><i class="fa fa-camera fa-lg"></i> Descargar Fotos</button> 
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div id="modal-envioAppMovil" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title"><i class="fa fa-cogs fa-lg"></i>Enviar al Movil</h6>
                </div>
                <div class="panel-body">
                    <form class="form-horizontal">

                        <fieldset class="fieldset-border">
                            <legend>Enviar Datos al Aplicativo Movil</legend>
                            <div class="row">
                                <div class="col-md-12">
                                    <div class="col-md-10">
                                        <div class="form-group">
                                            <label class="control-label">
                                                Fecha Asignación :
                                            </label>
                                            <br />
                                            <br />
                                            <div class="form-group form-group-sm">
                                                <div class="input-group">
                                                    <input class="form-control" id="_fechaEnvioMovil" placeholder="dia/mes/año" type="text" value="@DateTime.Now.ToString("dd/MM/yyyy")" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </fieldset>
                    </form>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button role="button" class="btn btn-primary" ng-click="UpdateFechaAplicativoMovil();"><i class="fa fa-mobile-phone fa-lg"></i> Enviar al Movil</button>
                                <button role="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close fa-lg"></i> Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-historico_LecturaRelectura" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style=" width: 60% !important;">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title"><i class="fa fa-cogs fa-lg"></i> HISTÓRICO LECTURA Y/O RELECTURA</h6>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <table id="table_historico_Lectura_Relectura" class="table table-condensed table-bordered table-responsive" cellspacing="0">
                            <thead style="background:#F0F3F5;">
                                <tr>
                                    <th>#</th>
                                    <th>Medidor</th>
                                    <th>Fecha de Lectura</th>
                                    <th>Lectura</th>
                                    <th>Operario</th>
                                    <th>Observación</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="lista in Lista_OrdenTrabajo_LecturaRelectura" on-finish-render="ngRepeatFinished">
                                    <td>{{$index + 1}}</td>
                                    <td>{{lista.medidor_lectura}}</td>
                                    <td>{{lista.fechaLecturaMovil_lectura}}</td>
                                    <td>{{lista.lectura_Anterior}}</td>
                                    <td>{{lista.ope_nombre}}</td>
                                    <td>{{lista.Observacion_lectura}}</td>
                                    <td>{{lista.abreviatura_estado}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button role="button" class="btn btn-default" ng-click="tableToExcel_Historico('#table_exportar_lecturaRelectura')"><i class="fa fa-download fa-lg"></i> Exportar</button>
                                <button role="button" id="btnCancelar" class="btn btn-default" style="background-color: #fff;" data-dismiss="modal"><i class="fa fa-close fa-lg"></i>Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal-reasignaoperador" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" id="modalreasig">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title"><i class="fa fa-cogs fa-lg"></i> RE-ASIGNAR OPERADOR</h6>
                </div>
                <div class="panel-body">
                    <form class="form-horizontal">
                        <div class="row">
                            <div class="col-md-12">
                                <fieldset class="fieldset-border">
                                    <legend>Reasignar Operador</legend>
                                    <div class="form-group form-group-sm">
                                        <br />
                                        <label for="_operador" class="col-sm-4 control-label">Operador</label>
                                        <div class="col-md-8">
                                            <div class="form-group form-group-sm">
                                                <select id="cbo_tecnicoReasignar" class="form-control">
                                                    <option value=0>--[ Seleccione ]-- </option>
                                                    <option ng-repeat="item in ListaTecnicoReasignar" value="{{item.ope_id}}">
                                                        {{item.ope_nombre}}
                                                    </option>
                                                </select>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="form-group form-group-sm">
                                        <label for="_fechaReasignaOperador" class="col-sm-4 control-label">Fecha Toma</label>
                                        <div class="col-md-1">
                                            <div class="form-group form-group-sm">
                                                <div class="input-group">
                                                    <input style="width:90px;" class="form-control" id="_fechaReasignaOperador" placeholder="dia/mes/año" type="text" value="@DateTime.Now.ToString("dd/MM/yyyy")" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </fieldset>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button role="button" class="btn btn-success" ng-click="updReasignaOperador(0);"><i class="fa fa-save fa-lg"></i> Guardar</button>
                                <button role="button" class="btn btn-primary" ng-click="updReasignaOperador(1);"><i class="fa fa-mobile-phone fa-lg"></i> Enviar al Movil</button>
                                <button role="button" class="btn btn-default" data-dismiss="modal" ng-click="CerraModalReasignar()"><i class="fa fa-close fa-lg"></i> Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <table id="table_exportar_lecturaRelectura" ng-show="false">
        <tr>
            <th>Medidor</th>
            <th>Fecha de Lectura</th>
            <th>Lectura</th>
            <th>Operario</th>
            <th>Observación</th>
            <th>Estado</th>
        </tr>
        <tr ng-repeat="lista in Lista_OrdenTrabajo_LecturaRelectura">
            <td>{{lista.medidor_lectura}}</td>
            <td>{{lista.fechaLecturaMovil_lectura}}</td>
            <td>{{lista.lectura_Anterior}}</td>
            <td>{{lista.ope_nombre}}</td>
            <td>{{lista.Observacion_lectura}}</td>
            <td>{{lista.abreviatura_estado}}</td>
        </tr>
    </table>


    <table id="table_exportar_CortesReconexiones" ng-show="false">
        <tr>
            <th>#</th>
            <th>Medidor</th>
            <th>Fecha de Lectura</th>
            <th>Lectura</th>
            <th>Operario</th>
            <th>Observación</th>
            <th>Estado</th>
        </tr>
        <tr ng-repeat="lista in Lista_OrdenTrabajo_CortesReconexiones">
            <td>{{$index + 1}}</td>
            <td>{{lista.medidor_corte}}</td>
            <td>{{lista.fechaAsignacion_corte}}</td>
            <td>{{lista.id_Corte}}</td>
            <td>{{lista.ope_nombre}}</td>
            <td>{{lista.Observacion_corte}}</td>
            <td>{{lista.abreviatura_estado}}</td>
        </tr>
    </table>

    <div id="modal-historico_CortesReconexiones" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style=" width: 60% !important;">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title"><i class="fa fa-cogs fa-lg"></i> HISTÓRICO LECTURA Y/O RELECTURA</h6>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <table id="table_historico_CortesReconexiones" class="table table-condensed table-bordered table-responsive" cellspacing="0">
                            <thead style="background:#F0F3F5;">
                                <tr>
                                    <th>#</th>
                                    <th>Medidor</th>
                                    <th>Fecha de Corte</th>
                                    <th>Corte</th>
                                    <th>Operario</th>
                                    <th>Observación</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="lista in Lista_OrdenTrabajo_CortesReconexiones">
                                    <td>{{$index + 1}}</td>
                                    <td>{{lista.medidor_corte}}</td>
                                    <td>{{lista.fechaAsignacion_corte}}</td>
                                    <td>{{lista.id_Corte}}</td>
                                    <td>{{lista.ope_nombre}}</td>
                                    <td>{{lista.Observacion_corte}}</td>
                                    <td>{{lista.abreviatura_estado}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button role="button" class="btn btn-default" ng-click="tableToExcel_Historico('#table_exportar_CortesReconexiones')"><i class="fa fa-download fa-lg"></i> Exportar</button>
                                <button role="button" id="btnCancelar" class="btn btn-default" style="background-color: #fff;" data-dismiss="modal"><i class="fa fa-close fa-lg"></i>Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="fotos" class="modal fade">
        <div class="modal-dialog" style="width:500px; height:450px; text-align: center;">

            <div class="modal-body" style="text-align: center; background-color: white;">

                <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
                    <!-- Indicators -->
                    <!-- Wrapper for slides -->
                    <div class="carousel-inner" id="corre">
                    </div>

                    <!-- Controls -->
                    <a class="left carousel-control" href="#carousel-example-generic" ng-click="previusPhoto()" role="button" data-slide="prev" style="background-color:black;">
                        <span class="glyphicon glyphicon-chevron-left"></span>
                    </a>
                    <a class="right carousel-control" href="#carousel-example-generic" ng-click="nextPhoto()" role="button" data-slide="next" style="background-color:black;">
                        <span class="glyphicon glyphicon-chevron-right"></span>
                    </a>
                </div>
                <!-- Carousel -->
            </div>
        </div>
    </div>


    <div id="modal_VisualizarPendientes" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style=" width: 60% !important;">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title"><i class="fa fa-cogs fa-lg"></i> Visualizar Pendientes</h6>
                </div>
                <div class="panel-body">
                    <form class="form-inline">
                        <div class="form-group">
                            <label for="_fechaPendientes" class="control-label">Fecha Asignación : </label>
                            <input style=" width: 120px;" class="form-control" id="_fechaPendientes" placeholder="dia/mes/año" type="text" value="@DateTime.Now.ToString("dd/MM/yyyy")" />
                        </div>
                        <button role="button" class="btn btn-danger btn-sm" ng-click="VisualizarPendientes();"><i class="fa fa-windows fa-lg"></i> Visualizar Pendientes</button>
                        <hr />
                    </form>

                    <table id="tbl_VisualizarPendientes" class="table table-condensed table-bordered table-responsive" cellspacing="0">
                        <thead style="background:#F0F3F5;">
                            <tr>
                                <th>#</th>
                                <th>OPERARIO</th>
                                <th>ESTADO</th>
                                <th>CANTIDAD</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr ng-repeat="lista in Lista_PendientesLiquidaciones" on-finish-render="ngRepeatFinishedPendiente">
                                <td>{{$index + 1}}</td>
                                <td>{{lista.Operario}}</td>
                                <td>{{lista.Estado}}</td>
                                <td>{{lista.Cantidad}}</td>
                                <td><a data-toggle="modal" data-target="#modal_detalladoPendientes" ng-click="Visualizar_DetalladoPendientes(lista);" href="#"> Ver Detalle</a></td>
                            </tr>
                        </tbody>
                    </table>

                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button role="button" class="btn btn-default" ng-click="tableToExcel_Pendientes('#table_Pendientes')"><i class="fa fa-download fa-lg"></i> Exportar</button>
                                <button role="button" id="btnCancelar" class="btn btn-default" style="background-color: #fff;" data-dismiss="modal"><i class="fa fa-close fa-lg"></i>Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <table id="table_Pendientes" ng-show="false">
        <tr>
            <th>#</th>
            <th>OPERARIO</th>
            <th>ESTADO</th>
            <th>CANTIDAD</th>
        </tr>
        <tr ng-repeat="lista in Lista_PendientesLiquidaciones">
            <td>{{$index + 1}}</td>
            <td>{{lista.Operario}}</td>
            <td>{{lista.Estado}}</td>
            <td>{{lista.Cantidad}}</td>
        </tr>
    </table>
       
    <div id="modal_detalladoPendientes" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style=" width: 60% !important;">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title"><i class="fa fa-cogs fa-lg"></i> DETALLADO DE PENDIENTES</h6>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <table id="tbl_detallado_Pendientes" class="table table-condensed table-bordered table-responsive" cellspacing="0">
                            <thead style="background:#F0F3F5;">
                                <tr>
                                    <th>#</th>
                                    <th>Orden</th>
                                    <th>Cuenta Contrato</th>
                                    <th>Nro Instalacion</th>
                                    <th>Nro Serie</th>
                                    <th>Direccion</th>
                                    <th>Ubicacion Med.</th>
                                    <th>Fecha Alta</th>
                                    <th>Cliente</th>
                                    <th>Inter Locutor</th>
                                    <th>Operario</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr ng-repeat="lista in Lista_Detallado_PendientesLiquidaciones" on-finish-render="ngRepeatFinishedPendiente_Det">
                                    <td>{{$index + 1}}</td>
                                    <td>{{lista.Orden}}</td>
                                    <td>{{lista.Cuenta_Contrato}}</td>
                                    <td>{{lista.Nro_Instalacion}}</td>
                                    <td>{{lista.Nro_Serie}}</td>
                                    <td>{{lista.Direccion}}</td>
                                    <td>{{lista.Ubicacion_Med}}</td>

                                    <td>{{lista.Fecha_Alta}}</td>
                                    <td>{{lista.Cliente}}</td>
                                    <td>{{lista.Inter_Locutor}}</td>
                                    <td>{{lista.Operario}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button role="button" class="btn btn-default" ng-click="tableToExcel_Pendientes_Detallado('#table_PendientesDetallado')"><i class="fa fa-download fa-lg"></i> Exportar</button>
                                <button role="button" id="btnCancelar" class="btn btn-default" style="background-color: #fff;" data-dismiss="modal"><i class="fa fa-close fa-lg"></i>Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <table id="table_PendientesDetallado" ng-show="false">
        <tr>
            <th>#</th>
            <th>Orden</th>
            <th>Cuenta Contrato</th>
            <th>Nro Instalacion</th>
            <th>Nro Serie</th>
            <th>Direccion</th>
            <th>Ubicacion Med.</th>
            <th>Fecha Alta</th>
            <th>Cliente</th>
            <th>Inter Locutor</th>
            <th>Operario</th>
        </tr>
        <tr ng-repeat="lista in Lista_Detallado_PendientesLiquidaciones">
            <td>{{$index + 1}}</td>
            <td>{{lista.Orden}}</td>
            <td>{{lista.Cuenta_Contrato}}</td>
            <td>{{lista.Nro_Instalacion}}</td>
            <td>{{lista.Nro_Serie}}</td>
            <td>{{lista.Direccion}}</td>
            <td>{{lista.Ubicacion_Med}}</td>

            <td>{{lista.Fecha_Alta}}</td>
            <td>{{lista.Cliente}}</td>
            <td>{{lista.Inter_Locutor}}</td>
            <td>{{lista.Operario}}</td>
        </tr>
    </table>
     
    <div id="modalfotos" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style="width: 40% !important;">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title"><i class="fa fa-cogs fa-lg"></i> RELACIÓN DE FOTOS </h6>
                </div>
                <div class="panel-body">
                    <div class="form-group">
                        <div id="galeria" class="table table-responsive" style="max-height: 510px !important;overflow: auto;">
                            <div class="thumbnails">
                                <div class="col-md-12" style=" text-align:center;" ng-repeat="pic in pictures">

                                    <a href="{{pic.url}}" target="_blank" data-lightbox="example-set" data-title="Fotos">
                                        <img class="img-thumbnail" ng-src="{{pic.url}}" style="width: 530px; height: 310px;">
                                    </a>
   
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button role="button" id="btnCancelar" class="btn btn-default" style="background-color: #fff;" data-dismiss="modal"><i class="fa fa-close fa-lg"></i> Salir</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div id="modal_importacion" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog  modal_dsige " style="width:98%;">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h6 class="modal-title"><i class="fa fa-calendar fa-lg"></i> Importacion Trabajos Manuales</h6>
                </div>
                <div class="panel-body">
                    <hr style="margin-top: -1px;margin-bottom: 7px;" />
                    <div class="row">
                        <div class="col-xs-12 col-sm-6 col-md-4  col-lg-4 ">
                            <input id="id_seleccionFile" type="file" class="filestyle" file-model="myFile" data-placeholder="Ningun Archivo Seleccionado" data-buttonname="btn-primary" data-size="sm" data-buttonbefore="true" data-buttontext="  Seleccionar Archivo..">
                        </div>
                        <div class="col-xs-4 col-sm-6 col-md-4  col-lg-4 ">
                            <form class="form-horizontal" role="form">
                                <div class="form-group">
                                    <label for="dtp_fecha_lectura" class="col-sm-6 col-md-6 col-lg-6 control-label"> Fecha lectura móvil</label>
                                    <div class="col-sm-6 col-md-6 col-lg-6">
                                        <input style=" width: 120px;" class="form-control" id="dtp_fecha_lectura" placeholder="dia/mes/año" type="text" value="@DateTime.Now.ToString("dd/MM/yyyy")" />
                                    </div>
                                </div>
                            </form>
                        </div>
                        <div class="col-xs-8 col-sm-12 col-md-4  col-lg-4 " style="text-align:center">
                            <button id="btn_ver" type="button" class="btn btn-primary btn-sm" ng-click="uploadFile()"><i class="fa fa-upload"></i> Guardar Información</button>
                            <button id="btn_nueva" type="button" class="btn btn-primary btn-sm" ng-click="nuevaimportacion();"><i class="fa fa-file-excel-o"></i> Nueva Importacion</button>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6" style="margin-top: 2px;">
                            <button class="btn btn-xs btn-danger"><span class="glyphicon glyphicon-remove"></span> </button>
                            <label for="checkbox6" style="font-size: 11px; letter-spacing: normal; font-family: tahoma; color:red;">Registros incorrectos .</label>
                        </div>
                        <div class="col-md-6" style="margin-top: 2px;">
                            <span class="label label-success" style="font-size: 11px;"> Después que ingrese la Lectura pulsar la Tecla Enter</span>
                        </div>
                    </div>

                    <div class="row" id="form_cabecera" style="display:none">
                        <div class="col-md-12 col-sm-12 col-lg-12">
                            <div class="form-group">
                                <table id="tbl_alertas" class="table table-condensed table-bordered table-responsive" cellspacing="0" style="font-family: tahoma;margin-bottom: 0px; font-size: 10px;">
                                    <thead style="background:#F0F3F5;">
                                        <tr>
                                            <th>#</th>
                                            <th>UNIDAD_LECTURA</th>
                                            <th style="text-align:center">SUMINISTRO</th>
                                            <th> MEDIDOR</th>
                                            <th>LECTURISTA</th>
                                            <th>OBS_ACTUAL</th>
                                            <th>LECT_MAXIMA.</th>
                                            <th>LECT_ACTUAL</th>
                                            <th>LECT_MINIMA</th>


                                            <th>COMPARTIVA_MAX</th>
                                            <th>COMPARTIVA_MIN</th>
                                            <th><div style="width:200px">RESULTADOS</div></th>
                                        </tr>
                                    </thead>
                                    <tbody style="font-family: tahoma; font-size: 9px;">
                                        <tr ng-repeat="lista in ListaAlertas" on-finish-render="ngRepeatFinished_alerta">
                                            <td>{{$index + 1}}</td>
                                            <td>{{lista.unidad_lectura}}</td>
                                            <td>{{lista.suministro_lectura}}</td>
                                            <td>{{lista.medidor_lectura}}</td>
                                            <td> {{lista.operario}}   </td>
                                            <td>{{lista.descripcion_observacion}}</td>

                                            <td style="text-align:center">{{lista.lectura_mxa}}</td>
                                            <td style="text-align:center"><b> <input id="id_{{$index}}" class="form-control" title="Después que ingrese la Lectura pulsar la Tecla Enter" type="text" style="color:black;background-color:#fcf8e3;text-align:right" ng-model="lista.lectura_movil" ng-keypress="KeyDown_Lectura($event,lista,$index)" />  </b>  </td>

                                            <td style="text-align:right">{{lista.lectura_min}}</td>
                                            <td style="text-align:right">{{lista.comparativa_max}}</td>
                                            <td style="text-align:right">{{lista.comparativa_min}}</td>
                                            <td style="color:red;font-size: 10px;"> <div style="width:200px">{{lista.resultado}}</div>   </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <hr style="margin-top: -1px;margin-bottom: 7px;" />
                    <div class="row">
                        <div class="col-sm-12 col-md-12" style="text-align:center">
                            <button id="btn_guardar" type="button" class="btn btn-primary btn-sm" ng-click="Actualizar_Lecturas()"><span class="glyphicon glyphicon-floppy-disk"></span> Actualizar</button>
                            <button id="btn_guardarVac" type="button" class="btn btn-danger btn-sm" ng-click="Actualizar_Lecturas_Vacias()"><span class="glyphicon glyphicon-floppy-disk"></span> Guardar Todas (Lectura Observadas)</button>
                        </div>
                    </div>
                </div>


                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button id="btn_cancel" role="button" class="btn btn-default" data-dismiss="modal"><i class="fa fa-close fa-lg"></i> Cancelar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

 

    <div id="modalCorteReconexion" class="modal fade" role="dialog" tabindex="-1" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" style="width:  300px !important;">
            <div class="panel panel-oscuro">
                <div class="panel-heading">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h5 class="modal-title"><i class="fa fa-cogs fa-lg"></i> Detalle </h5>
                </div>
                <div class="panel-body">
                    <div class="row">
                        <div class="col-md-12">
                            <label for="cbo_tipoReporte" class="control-label"> Servicio :  {{nombreServicio}}</label>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-12">
                            <label style="width: 100px;" for="cbo_tipoReporte" class="control-label">Tipo :</label>
                            <select class="form-control" id="cbo_tipoReporte">
                                <option value="0" selected="selected">  -- SELECCIONE --</option>
                                <option value="1">     EFECTIVA - EXITOSA   </option>
                                <option value="2">     NO EFECTIVA - INFRUCTUOSA    </option>
                            </select>
                        </div>
                    </div>

                </div>
                <div class="panel-footer">
                    <div class="row">
                        <div class="col-sm-12">
                            <div class="btn-group btn-group-sm" role="group" aria-label="Mantenimiento" style="float: right;">
                                <button role="button" class="btn btn-info btn-sm" ng-click="DescargaExcel_EnvioCliente_CorteReconexion();"><i class="fa fa-download fa-lg"></i> Envio al Cliente</button>
                                <button role="button" id="btnCancelar" class="btn btn-default" style="background-color: #fff;" data-dismiss="modal"><i class="fa fa-close fa-lg"></i> Cerrar</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

 
 

</div>